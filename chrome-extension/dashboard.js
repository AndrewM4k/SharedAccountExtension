import{j as e,c as m,r as o}from"./client.js";const v=({actions:l,loading:i,totalCount:t,currentPage:r,pageSize:j,onPageChange:d})=>{const s=Math.ceil(t/j),h=a=>{try{return JSON.parse(a)}catch{return{}}};return i?e.jsx("div",{className:"loading-indicator",children:"Загрузка событий..."}):e.jsxs("div",{className:"actions-table",children:[e.jsxs("table",{className:"table m-3",children:[e.jsx("thead",{className:"thead-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Пользовательский ID"}),e.jsx("th",{children:"Время"}),e.jsx("th",{children:"Событие"}),e.jsx("th",{children:"Номер лота"}),e.jsx("th",{children:"Детали"})]})}),e.jsx("tbody",{children:l&&l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"no-data",children:"Нет сбоытий"})}):l&&l.map(a=>{const p=h(a.details);return e.jsxs("tr",{children:[e.jsx("td",{children:a.userId}),e.jsx("td",{children:new Date(a.actionTime).toLocaleString()}),e.jsx("td",{children:e.jsx("span",{className:`action-badge ${a.actionType.toLowerCase()}`,children:a.actionType})}),e.jsx("td",{children:a.lotNumber||"N/A"}),e.jsx("td",{className:"details-cell",children:e.jsx("div",{className:"details-summary",children:Object.entries(p).map(([x,n])=>e.jsxs("div",{children:[e.jsxs("strong",{children:[x,":"]})," ",String(n)]},x))})})]},a.id)})})]}),s>1&&e.jsxs("div",{className:"pagination",children:[e.jsx("button",{disabled:r===1,onClick:()=>d(r-1),children:"Предыдущая"}),e.jsxs("span",{children:["Страница ",r," of ",s]}),e.jsx("button",{disabled:r===s,onClick:()=>d(r+1),children:"Следующая"})]})]})},b=[{value:"",label:"All Actions"},{value:"BID",label:"Bids"},{value:"PURCHASE",label:"Purchases"},{value:"LOGIN",label:"Logins"},{value:"LOGOUT",label:"Logouts"}],S=({filters:l,onFilterChange:i})=>e.jsxs("div",{className:"action-filters",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Action Type:"}),e.jsx("select",{value:l.actionType,onChange:t=>i({actionType:t.target.value}),children:b.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Search:"}),e.jsx("input",{type:"text",placeholder:"Search lot or details...",value:l.search,onChange:t=>i({search:t.target.value})})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Items per page:"}),e.jsxs("select",{value:l.pageSize,onChange:t=>i({pageSize:Number(t.target.value)}),children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]})]})]}),N=()=>{const[l,i]=o.useState([]),[t,r]=o.useState(!0),[j,d]=o.useState(0),[s,h]=o.useState({page:1,pageSize:20,actionType:"",search:""}),a=async()=>{r(!0);try{const n=localStorage.getItem("token"),c=new URLSearchParams({page:s.page.toString(),pageSize:s.pageSize.toString(),...s.actionType&&{actionType:s.actionType},...s.search&&{search:s.search}}).toString(),u=await fetch(`https://localhost:5001/api/actions?${c}`,{headers:{Authorization:`Bearer ${n}`}});if(!u.ok)throw new Error("Failed to fetch actions");const g=await u.json();i(g.data),d(g.totalCount)}catch(n){console.error("Error fetching actions:",n)}finally{r(!1)}};o.useEffect(()=>{a()},[s]);const p=n=>{h(c=>({...c,page:n}))},x=n=>{h(c=>({...c,...n,page:1}))};return e.jsxs("div",{className:"dashboard-container",children:[e.jsx("h1",{children:"Пользовательские действия"}),e.jsx(S,{filters:s,onFilterChange:x}),e.jsx(v,{actions:l,loading:t,totalCount:j,currentPage:s.page,pageSize:s.pageSize,onPageChange:p})]})},y=m.createRoot(document.getElementById("root"));y.render(e.jsx(N,{}));
