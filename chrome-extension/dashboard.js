import{j as e,c as g,r as i,a as j,b as v,i as N}from"./apiService.js";const f=({actions:t,loading:r,totalCount:s,currentPage:o,pageSize:h,onPageChange:d})=>{const a=Math.ceil(s/h);return r?e.jsx("div",{className:"loading-indicator",children:"Загрузка событий..."}):e.jsxs("div",{className:"actions-table",children:[e.jsxs("table",{className:"table m-3",children:[e.jsx("thead",{className:"thead-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Пользовательский ID"}),e.jsx("th",{children:"Имя"}),e.jsx("th",{children:"Время"}),e.jsx("th",{children:"Событие"}),e.jsx("th",{children:"Номер лота"}),e.jsx("th",{children:"Детали"})]})}),e.jsx("tbody",{children:t&&t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"no-data",children:"Нет событий"})}):t&&t.map(n=>{const u=n.details||"";return e.jsxs("tr",{children:[e.jsx("td",{children:n.userId}),e.jsx("td",{children:n.username||"N/A"}),e.jsx("td",{children:new Date(n.actionTime).toLocaleString()}),e.jsx("td",{children:e.jsx("span",{className:`action-badge ${n.actionType.toLowerCase()}`,children:n.actionType})}),e.jsx("td",{children:n.lotNumber||"N/A"}),e.jsx("td",{className:"details-cell",children:u||"N/A"})]},n.id)})})]}),a>1&&e.jsxs("div",{className:"pagination",children:[e.jsx("button",{disabled:o===1,onClick:()=>d(o-1),children:"Предыдущая"}),e.jsxs("span",{children:["Страница ",o," of ",a]}),e.jsx("button",{disabled:o===a,onClick:()=>d(o+1),children:"Следующая"})]})]})},b=[{value:"",label:"All Actions"},{value:"BID",label:"Bids"},{value:"LOGIN",label:"Logins"}],w=({filters:t,onFilterChange:r})=>e.jsxs("div",{className:"action-filters w50",children:[e.jsx("div",{className:"filter-row w100",children:e.jsxs("div",{className:"filter-group w90",children:[e.jsx("label",{children:"Поиск (по имени и действию):"}),e.jsx("input",{className:"form-control",type:"text",placeholder:"Поиск по имени пользователя или типу действия...",value:t.search,onChange:s=>r({search:s.target.value})})]})}),e.jsxs("div",{className:"filter-row",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"ID пользователя:"}),e.jsx("input",{className:"form-control",type:"text",placeholder:"ID пользователя",value:t.userId,onChange:s=>r({userId:s.target.value})})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Тип события:"}),e.jsx("select",{className:"form-select",value:t.actionType,onChange:s=>r({actionType:s.target.value}),children:b.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsx("div",{className:"filter-row",children:e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Фильтр по номеру лота:"}),e.jsx("input",{className:"form-control",type:"text",placeholder:"Поиск по номеру лота...",value:t.lotNumber,onChange:s=>r({lotNumber:s.target.value})})]})}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Штук на странице:"}),e.jsxs("select",{className:"form-select",value:t.pageSize,onChange:s=>r({pageSize:Number(s.target.value)}),children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]})]})]}),e.jsxs("div",{className:"filter-row",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Дата начала:"}),e.jsx("input",{className:"form-control",type:"date",value:t.startDate,onChange:s=>r({startDate:s.target.value})})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Дата окончания:"}),e.jsx("input",{className:"form-control",type:"date",value:t.endDate,onChange:s=>r({endDate:s.target.value})})]})]})]}),D=()=>{const[t,r]=i.useState([]),[s,o]=i.useState(!0),[h,d]=i.useState(0),[a,n]=i.useState({page:1,pageSize:20,actionType:"",search:"",userId:"",startDate:"",endDate:"",lotNumber:""}),u=async()=>{o(!0);const c=await j();if(console.log("accessTokenResponse: ",c),c.status!==200){const l=await v();if(console.log("refreshResponse: ",l),l.status!==200)throw new Error("Refresh failed");const x=await j();if(console.log("accessTokenResponse: ",x),x.status!==200)throw new Error("Still not authenticated after refresh")}try{const l=await N({page:a.page,pageSize:a.pageSize,actionType:a.actionType||void 0,search:a.search||void 0,userId:a.userId||void 0,startDate:a.startDate||void 0,endDate:a.endDate||void 0,lotNumber:a.lotNumber||void 0});if(l.status!==200)throw new Error("Failed to fetch actions");console.log("response.data ",l.data),r(l.data.data||[]),d(l.data.totalCount||0)}catch(l){console.error("Error fetching actions:",l)}finally{o(!1)}};i.useEffect(()=>{u()},[a]);const p=c=>{n(l=>({...l,page:c}))},m=c=>{n(l=>({...l,...c,page:1}))};return e.jsxs("div",{className:"dashboard-container",children:[e.jsx("h1",{children:"Пользовательские действия"}),e.jsx(w,{filters:a,onFilterChange:m}),e.jsx(f,{actions:t,loading:s,totalCount:h,currentPage:a.page,pageSize:a.pageSize,onPageChange:p})]})},y=g.createRoot(document.getElementById("root"));y.render(e.jsx(D,{}));
