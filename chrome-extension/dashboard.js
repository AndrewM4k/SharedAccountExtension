import{j as e,c as m,r as i,a as g,b as v,i as f}from"./apiService.js";const b=({actions:l,loading:o,totalCount:s,currentPage:n,pageSize:j,onPageChange:d})=>{const r=Math.ceil(s/j),h=t=>{try{return JSON.parse(t)}catch{return{}}};return o?e.jsx("div",{className:"loading-indicator",children:"Загрузка событий..."}):e.jsxs("div",{className:"actions-table",children:[e.jsxs("table",{className:"table m-3",children:[e.jsx("thead",{className:"thead-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Пользовательский ID"}),e.jsx("th",{children:"Время"}),e.jsx("th",{children:"Событие"}),e.jsx("th",{children:"Номер лота"}),e.jsx("th",{children:"Детали"})]})}),e.jsx("tbody",{children:l&&l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"no-data",children:"Нет событий"})}):l&&l.map(t=>{const u=h(t.details);return e.jsxs("tr",{children:[e.jsx("td",{children:t.userId}),e.jsx("td",{children:new Date(t.actionTime).toLocaleString()}),e.jsx("td",{children:e.jsx("span",{className:`action-badge ${t.actionType.toLowerCase()}`,children:t.actionType})}),e.jsx("td",{children:t.lotNumber||"N/A"}),e.jsx("td",{className:"details-cell",children:e.jsx("div",{className:"details-summary",children:Object.entries(u).map(([x,c])=>e.jsxs("div",{children:[e.jsxs("strong",{children:[x,":"]})," ",String(c)]},x))})})]},t.id)})})]}),r>1&&e.jsxs("div",{className:"pagination",children:[e.jsx("button",{disabled:n===1,onClick:()=>d(n-1),children:"Предыдущая"}),e.jsxs("span",{children:["Страница ",n," of ",r]}),e.jsx("button",{disabled:n===r,onClick:()=>d(n+1),children:"Следующая"})]})]})},N=[{value:"",label:"All Actions"},{value:"BID",label:"Bids"},{value:"PURCHASE",label:"Purchases"},{value:"LOGIN",label:"Logins"},{value:"LOGOUT",label:"Logouts"}],w=({filters:l,onFilterChange:o})=>e.jsxs("div",{className:"action-filters w50",children:[e.jsx("div",{className:"filter-row w100",children:e.jsx("div",{className:"filter-group w90",children:e.jsx("input",{className:"form-control",type:"text",placeholder:"Поиск...",value:l.search,onChange:s=>o({search:s.target.value})})})}),e.jsxs("div",{className:"filter-row",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Тип события:"}),e.jsx("select",{className:"form-select",value:l.actionType,onChange:s=>o({actionType:s.target.value}),children:N.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Штук на странице:"}),e.jsxs("select",{className:"form-select",value:l.pageSize,onChange:s=>o({pageSize:Number(s.target.value)}),children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]})]})]})]}),S=()=>{const[l,o]=i.useState([]),[s,n]=i.useState(!0),[j,d]=i.useState(0),[r,h]=i.useState({page:1,pageSize:20,actionType:"",search:""}),t=async()=>{n(!0);const c=await g();if(console.log("accessTokenResponse: ",c),c.status!==200){const a=await v();if(console.log("refreshResponse: ",a),a.status!==200)throw new Error("Refresh failed");const p=await g();if(console.log("accessTokenResponse: ",p),p.status!==200)throw new Error("Still not authenticated after refresh")}try{const a=await f();if(a.status!==200)throw new Error("Failed to fetch actions");console.log("response.data ",a.data),o(a.data),d(a.data.totalCount)}catch(a){console.error("Error fetching actions:",a)}finally{n(!1)}};i.useEffect(()=>{t()},[r]);const u=c=>{h(a=>({...a,page:c}))},x=c=>{h(a=>({...a,...c,page:1}))};return e.jsxs("div",{className:"dashboard-container",children:[e.jsx("h1",{children:"Пользовательские действия"}),e.jsx(w,{filters:r,onFilterChange:x}),e.jsx(b,{actions:l,loading:s,totalCount:j,currentPage:r.page,pageSize:r.pageSize,onPageChange:u})]})},T=m.createRoot(document.getElementById("root"));T.render(e.jsx(S,{}));
