import{j as e,c as m,r as o,a as v}from"./apiService.js";const b=({actions:l,loading:c,totalCount:s,currentPage:r,pageSize:j,onPageChange:d})=>{const a=Math.ceil(s/j),h=t=>{try{return JSON.parse(t)}catch{return{}}};return c?e.jsx("div",{className:"loading-indicator",children:"Загрузка событий..."}):e.jsxs("div",{className:"actions-table",children:[e.jsxs("table",{className:"table m-3",children:[e.jsx("thead",{className:"thead-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Пользовательский ID"}),e.jsx("th",{children:"Время"}),e.jsx("th",{children:"Событие"}),e.jsx("th",{children:"Номер лота"}),e.jsx("th",{children:"Детали"})]})}),e.jsx("tbody",{children:l&&l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"no-data",children:"Нет сбоытий"})}):l&&l.map(t=>{const p=h(t.details);return e.jsxs("tr",{children:[e.jsx("td",{children:t.userId}),e.jsx("td",{children:new Date(t.actionTime).toLocaleString()}),e.jsx("td",{children:e.jsx("span",{className:`action-badge ${t.actionType.toLowerCase()}`,children:t.actionType})}),e.jsx("td",{children:t.lotNumber||"N/A"}),e.jsx("td",{className:"details-cell",children:e.jsx("div",{className:"details-summary",children:Object.entries(p).map(([x,n])=>e.jsxs("div",{children:[e.jsxs("strong",{children:[x,":"]})," ",String(n)]},x))})})]},t.id)})})]}),a>1&&e.jsxs("div",{className:"pagination",children:[e.jsx("button",{disabled:r===1,onClick:()=>d(r-1),children:"Предыдущая"}),e.jsxs("span",{children:["Страница ",r," of ",a]}),e.jsx("button",{disabled:r===a,onClick:()=>d(r+1),children:"Следующая"})]})]})},S=[{value:"",label:"All Actions"},{value:"BID",label:"Bids"},{value:"PURCHASE",label:"Purchases"},{value:"LOGIN",label:"Logins"},{value:"LOGOUT",label:"Logouts"}],N=({filters:l,onFilterChange:c})=>e.jsxs("div",{className:"action-filters",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Action Type:"}),e.jsx("select",{value:l.actionType,onChange:s=>c({actionType:s.target.value}),children:S.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Search:"}),e.jsx("input",{type:"text",placeholder:"Search lot or details...",value:l.search,onChange:s=>c({search:s.target.value})})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Items per page:"}),e.jsxs("select",{value:l.pageSize,onChange:s=>c({pageSize:Number(s.target.value)}),children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]})]})]}),y=()=>{const[l,c]=o.useState([]),[s,r]=o.useState(!0),[j,d]=o.useState(0),[a,h]=o.useState({page:1,pageSize:20,actionType:"",search:""}),t=async()=>{r(!0),await v();try{const n=localStorage.getItem("token"),i=new URLSearchParams({page:a.page.toString(),pageSize:a.pageSize.toString(),...a.actionType&&{actionType:a.actionType},...a.search&&{search:a.search}}).toString(),u=await fetch(`https://localhost:5001/api/actions?${i}`,{headers:{Authorization:`Bearer ${n}`}});if(!u.ok)throw new Error("Failed to fetch actions");const g=await u.json();c(g.data),d(g.totalCount)}catch(n){console.error("Error fetching actions:",n)}finally{r(!1)}};o.useEffect(()=>{t()},[a]);const p=n=>{h(i=>({...i,page:n}))},x=n=>{h(i=>({...i,...n,page:1}))};return e.jsxs("div",{className:"dashboard-container",children:[e.jsx("h1",{children:"Пользовательские действия"}),e.jsx(N,{filters:a,onFilterChange:x}),e.jsx(b,{actions:l,loading:s,totalCount:j,currentPage:a.page,pageSize:a.pageSize,onPageChange:p})]})},f=m.createRoot(document.getElementById("root"));f.render(e.jsx(y,{}));
