import{j as e,c as g,r as i,a as m,b as v,i as f}from"./apiService.js";const N=({actions:l,loading:n,totalCount:s,currentPage:c,pageSize:u,onPageChange:d})=>{const a=Math.ceil(s/u),h=t=>{try{return JSON.parse(t)}catch{return{}}};return n?e.jsx("div",{className:"loading-indicator",children:"Загрузка событий..."}):e.jsxs("div",{className:"actions-table",children:[e.jsxs("table",{className:"table m-3",children:[e.jsx("thead",{className:"thead-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Пользовательский ID"}),e.jsx("th",{children:"Имя"}),e.jsx("th",{children:"Время"}),e.jsx("th",{children:"Событие"}),e.jsx("th",{children:"Номер лота"}),e.jsx("th",{children:"Детали"})]})}),e.jsx("tbody",{children:l&&l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"no-data",children:"Нет событий"})}):l&&l.map(t=>{const j=t.details?h(t.details):t.commentary?{commentary:t.commentary}:{};return e.jsxs("tr",{children:[e.jsx("td",{children:t.userId}),e.jsx("td",{children:t.username||"N/A"}),e.jsx("td",{children:new Date(t.actionTime).toLocaleString()}),e.jsx("td",{children:e.jsx("span",{className:`action-badge ${t.actionType.toLowerCase()}`,children:t.actionType})}),e.jsx("td",{children:t.lotNumber||"N/A"}),e.jsx("td",{className:"details-cell",children:e.jsx("div",{className:"details-summary",children:Object.entries(j).map(([x,o])=>e.jsxs("div",{children:[e.jsxs("strong",{children:[x,":"]})," ",String(o)]},x))})})]},t.id)})})]}),a>1&&e.jsxs("div",{className:"pagination",children:[e.jsx("button",{disabled:c===1,onClick:()=>d(c-1),children:"Предыдущая"}),e.jsxs("span",{children:["Страница ",c," of ",a]}),e.jsx("button",{disabled:c===a,onClick:()=>d(c+1),children:"Следующая"})]})]})},b=[{value:"",label:"All Actions"},{value:"BID",label:"Bids"},{value:"VIEW",label:"View"},{value:"LOGIN",label:"Logins"}],w=({filters:l,onFilterChange:n})=>e.jsxs("div",{className:"action-filters w50",children:[e.jsx("div",{className:"filter-row w100",children:e.jsxs("div",{className:"filter-group w90",children:[e.jsx("label",{children:"Поиск (по имени и действию):"}),e.jsx("input",{className:"form-control",type:"text",placeholder:"Поиск по имени пользователя или типу действия...",value:l.search,onChange:s=>n({search:s.target.value})})]})}),e.jsxs("div",{className:"filter-row",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"ID пользователя:"}),e.jsx("input",{className:"form-control",type:"text",placeholder:"ID пользователя",value:l.userId,onChange:s=>n({userId:s.target.value})})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Тип события:"}),e.jsx("select",{className:"form-select",value:l.actionType,onChange:s=>n({actionType:s.target.value}),children:b.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Штук на странице:"}),e.jsxs("select",{className:"form-select",value:l.pageSize,onChange:s=>n({pageSize:Number(s.target.value)}),children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]})]})]}),e.jsxs("div",{className:"filter-row",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Дата начала:"}),e.jsx("input",{className:"form-control",type:"date",value:l.startDate,onChange:s=>n({startDate:s.target.value})})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Дата окончания:"}),e.jsx("input",{className:"form-control",type:"date",value:l.endDate,onChange:s=>n({endDate:s.target.value})})]})]})]}),y=()=>{const[l,n]=i.useState([]),[s,c]=i.useState(!0),[u,d]=i.useState(0),[a,h]=i.useState({page:1,pageSize:20,actionType:"",search:"",userId:"",startDate:"",endDate:""}),t=async()=>{c(!0);const o=await m();if(console.log("accessTokenResponse: ",o),o.status!==200){const r=await v();if(console.log("refreshResponse: ",r),r.status!==200)throw new Error("Refresh failed");const p=await m();if(console.log("accessTokenResponse: ",p),p.status!==200)throw new Error("Still not authenticated after refresh")}try{const r=await f({page:a.page,pageSize:a.pageSize,actionType:a.actionType||void 0,search:a.search||void 0,userId:a.userId||void 0,startDate:a.startDate||void 0,endDate:a.endDate||void 0});if(r.status!==200)throw new Error("Failed to fetch actions");console.log("response.data ",r.data),n(r.data.data||[]),d(r.data.totalCount||0)}catch(r){console.error("Error fetching actions:",r)}finally{c(!1)}};i.useEffect(()=>{t()},[a]);const j=o=>{h(r=>({...r,page:o}))},x=o=>{h(r=>({...r,...o,page:1}))};return e.jsxs("div",{className:"dashboard-container",children:[e.jsx("h1",{children:"Пользовательские действия"}),e.jsx(w,{filters:a,onFilterChange:x}),e.jsx(N,{actions:l,loading:s,totalCount:u,currentPage:a.page,pageSize:a.pageSize,onPageChange:j})]})},D=g.createRoot(document.getElementById("root"));D.render(e.jsx(y,{}));
