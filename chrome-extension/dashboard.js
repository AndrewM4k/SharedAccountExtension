import{j as e,c as m,r as c}from"./client.js";const v=({actions:l,loading:i,totalCount:s,currentPage:r,pageSize:p,onPageChange:d})=>{const t=Math.ceil(s/p),h=a=>{try{return JSON.parse(a)}catch{return{}}};return i?e.jsx("div",{className:"loading-indicator",children:"Loading actions..."}):e.jsxs("div",{className:"actions-table",children:[e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User ID"}),e.jsx("th",{children:"Time"}),e.jsx("th",{children:"Action"}),e.jsx("th",{children:"Lot Number"}),e.jsx("th",{children:"Details"})]})}),e.jsx("tbody",{children:l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"no-data",children:"No actions found"})}):l.map(a=>{const j=h(a.details);return e.jsxs("tr",{children:[e.jsx("td",{children:a.userId}),e.jsx("td",{children:new Date(a.actionTime).toLocaleString()}),e.jsx("td",{children:e.jsx("span",{className:`action-badge ${a.actionType.toLowerCase()}`,children:a.actionType})}),e.jsx("td",{children:a.lotNumber||"N/A"}),e.jsx("td",{className:"details-cell",children:e.jsx("div",{className:"details-summary",children:Object.entries(j).map(([x,n])=>e.jsxs("div",{children:[e.jsxs("strong",{children:[x,":"]})," ",String(n)]},x))})})]},a.id)})})]}),t>1&&e.jsxs("div",{className:"pagination",children:[e.jsx("button",{disabled:r===1,onClick:()=>d(r-1),children:"Previous"}),e.jsxs("span",{children:["Page ",r," of ",t]}),e.jsx("button",{disabled:r===t,onClick:()=>d(r+1),children:"Next"})]})]})},b=[{value:"",label:"All Actions"},{value:"BID",label:"Bids"},{value:"PURCHASE",label:"Purchases"},{value:"LOGIN",label:"Logins"},{value:"LOGOUT",label:"Logouts"}],S=({filters:l,onFilterChange:i})=>e.jsxs("div",{className:"action-filters",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Action Type:"}),e.jsx("select",{value:l.actionType,onChange:s=>i({actionType:s.target.value}),children:b.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Search:"}),e.jsx("input",{type:"text",placeholder:"Search lot or details...",value:l.search,onChange:s=>i({search:s.target.value})})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Items per page:"}),e.jsxs("select",{value:l.pageSize,onChange:s=>i({pageSize:Number(s.target.value)}),children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]})]})]}),N=()=>{const[l,i]=c.useState([]),[s,r]=c.useState(!0),[p,d]=c.useState(0),[t,h]=c.useState({page:1,pageSize:20,actionType:"",search:""}),a=async()=>{r(!0);try{const n=localStorage.getItem("token"),o=new URLSearchParams({page:t.page.toString(),pageSize:t.pageSize.toString(),...t.actionType&&{actionType:t.actionType},...t.search&&{search:t.search}}).toString(),u=await fetch(`https://localhost:5001/api/actions?${o}`,{headers:{Authorization:`Bearer ${n}`}});if(!u.ok)throw new Error("Failed to fetch actions");const g=await u.json();i(g.data),d(g.totalCount)}catch(n){console.error("Error fetching actions:",n)}finally{r(!1)}};c.useEffect(()=>{a()},[t]);const j=n=>{h(o=>({...o,page:n}))},x=n=>{h(o=>({...o,...n,page:1}))};return e.jsxs("div",{className:"dashboard-container",children:[e.jsx("h1",{children:"Copart Actions Monitor"}),e.jsx(S,{filters:t,onFilterChange:x}),e.jsx(v,{actions:l,loading:s,totalCount:p,currentPage:t.page,pageSize:t.pageSize,onPageChange:j})]})},f=m.createRoot(document.getElementById("root"));f.render(e.jsx(N,{}));
