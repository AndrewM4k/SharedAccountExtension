import{c as k,j as e,r as o,a as c,b as i,g as R,m as h,f as g,h as y}from"./apiService.js";const U=()=>{const[u,p]=o.useState([]),[r,a]=o.useState({username:"",password:"",role:"User"}),[d,f]=o.useState("");o.useEffect(()=>{console.log("getting users"),n()},[]),o.useEffect(()=>{(async()=>{try{if((await c()).status!==200){if((await i()).status!==200)throw new Error("Refresh failed");if((await c()).status!==200)throw new Error("Still not authenticated after refresh")}if((await h()).data.role!="0")throw new Error("Access denied");n()}catch(t){console.error("Authentication check failed:",t)}})()},[]);const w=async()=>{try{if((await c()).status===200){await h();return}}catch{console.log("Check failed");try{if((await i()).status===200){const l=await c();if(console.log("recheckResponse.status: ",l.status),l.status===200){const m=await h();console.log("who is: ",m);return}}}catch(t){console.log("Refresh token failed:",t)}}},n=async()=>{try{await c()}catch(s){console.error("check failed: ",s),(await i()).status===200?console.error("refresh token succeed"):console.error("refresh token failed")}try{const s=await R();p(s.data)}catch(s){console.error("Failed to fetch users",s)}},x=async()=>{console.log("newUser: ",r);const s=await g(r);s.status===200?(a({username:"",password:"",role:"User"}),n()):(w(),f(await s.data))},j=async s=>{if(window.confirm(`Вы уверены, что хотите удалить пользователя: ${s.username}?`)){const t=await y(s.id);console.log("response: ",t),n()}};return e.jsxs("div",{className:"admin-container",children:[e.jsx("h1",{children:"Менеджмент пользователей"}),e.jsxs("div",{className:"create-user-form",children:[e.jsx("h2",{className:"ms-1 me-1",children:"Новый пользователь"}),e.jsxs("div",{className:"user-form-container",children:[e.jsx("input",{className:"form-control ms-1 me-1",type:"text",placeholder:"Имя пользователя",value:r.username,onChange:s=>a({...r,username:s.target.value})}),e.jsx("input",{className:"form-control ms-1 me-1",type:"password",placeholder:"Пароль",value:r.password,onChange:s=>a({...r,password:s.target.value})}),e.jsxs("select",{className:"form-select ms-1 me-1",value:r.role,onChange:s=>a({...r,role:s.target.value}),children:[e.jsx("option",{value:"User",children:"Пользователь"}),e.jsx("option",{value:"Admin",children:"Администратор"})]})]}),e.jsx("button",{className:"btn btn-primary ms-1 me-1 mt-2",onClick:x,children:"Создать нового пользователя"})]}),d&&e.jsx("div",{className:"error",children:d}),e.jsxs("table",{className:"table m-3",children:[e.jsx("thead",{className:"thead-light",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"ID"}),e.jsx("th",{scope:"col",children:"Имя пользователя"}),e.jsx("th",{scope:"col",children:"Роль"}),e.jsx("th",{scope:"col",children:"Действия"})]})}),e.jsx("tbody",{children:u.map(s=>e.jsxs("tr",{children:[e.jsx("td",{width:"10px",children:s.id}),e.jsx("td",{width:"30%",children:s.username}),e.jsx("td",{width:"20%",children:s.role=="0"?"Admin":"User"}),e.jsx("td",{width:"40%",children:e.jsx("button",{className:"btn btn-primary m-1",onClick:()=>j(s),children:"Удалить"})})]},s.id))})]})]})},N=k.createRoot(document.getElementById("root"));N.render(e.jsx(U,{}));
