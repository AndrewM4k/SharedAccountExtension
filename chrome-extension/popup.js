import{j as e,c as S,r as o,R as C}from"./client.js";import{a as i}from"./index.js";const E=({variant:t="danger",children:a})=>e.jsx("div",{className:`alert ${t}`,children:a}),L="http://localhost:5000/api",R=(t,a)=>i.post(`${L}/auth/login`,{email:t,password:a},{withCredentials:!0,headers:{"Content-Type":"application/json"}}),A=()=>{const[t,a]=o.useState(""),[u,f]=o.useState(""),[n,p]=o.useState(!1),[v,d]=o.useState(!1),[h,c]=o.useState(null),[m,x]=o.useState(""),g=async()=>{try{if((await i.get("https://localhost:5001/api/auth/check",{withCredentials:!0})).status===200){const l=await i.get("https://localhost:5001/api/auth/me",{withCredentials:!0});d(!0),x(l.data.role),a(l.data.username)}}catch{console.log("User not authenticated")}};C.useEffect(()=>{g()},[]);const y=async s=>{var l,j,b;s.preventDefault(),p(!0),c("");try{(await R(t,u)).status===200&&g()}catch(r){console.error("Full login error:",r),i.isAxiosError(r)?((l=r.response)==null?void 0:l.status)===401?c("Неверное имя пользователя или пароль"):c(`Ошибка сервера: ${(j=r.response)==null?void 0:j.status} - ${(b=r.response)==null?void 0:b.statusText}`):c("Неизвестная ошибка при входе")}finally{p(!1)}},N=async()=>{try{await i.post("https://localhost:5001/api/auth/logout",{},{withCredentials:!0}),d(!1),x("")}catch(s){console.error("Logout error:",s)}},w=()=>{chrome.tabs.create({url:chrome.runtime.getURL("admin.html")})};return n?e.jsx("div",{className:"popup-container",children:e.jsx("div",{className:"popup-text",children:"Проверка авторизации..."})}):e.jsxs("div",{className:"popup-container",children:[e.jsx("div",{className:"popup-header",children:" Вход в Shared Account"}),v?e.jsxs("div",{className:"popup-container",children:[e.jsxs("div",{className:"popup-text",children:["Вы вошли как: ",e.jsx("strong",{children:t}),e.jsx("br",{}),"Роль:"," ",e.jsx("strong",{children:m=="0"?"Администратор":"Пользователь"})]}),m=="0"&&e.jsx("button",{onClick:w,className:"btn btn-primary",children:"Панель администратора"}),e.jsx("div",{className:"logged-btn",children:e.jsx("button",{onClick:N,className:"btn btn-outline-secondary",children:"Выйти"})})]}):e.jsxs("form",{onSubmit:y,children:[e.jsx("div",{className:"input-group mb-3",children:e.jsx("input",{className:"form-control input",id:"username","aria-label":"Имя пользователя",type:"text",value:t,onChange:s=>a(s.target.value),disabled:n})}),e.jsx("div",{className:"input-group mb-3",children:e.jsx("input",{className:"form-control input",id:"password",type:"password","aria-label":"Пароль",value:u,onChange:s=>f(s.target.value),disabled:n})}),h&&e.jsx(E,{children:h}),e.jsx("button",{type:"submit",disabled:n,className:"btn btn-primary",children:n?"Вход...":"Войти"})]})]})},I=S.createRoot(document.getElementById("root"));I.render(e.jsx(A,{}));
