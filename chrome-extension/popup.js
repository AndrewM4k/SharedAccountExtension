import{j as e,c as S,r,R as E}from"./client.js";import{c as j,m as b,r as L,a as R,l as C}from"./apiService.js";const A=({variant:o="danger",children:n})=>e.jsx("div",{className:`alert ${o}`,children:n}),I=()=>{const[o,n]=r.useState(""),[m,v]=r.useState(""),[c,u]=r.useState(!1),[y,d]=r.useState(!1),[x,p]=r.useState(null),[f,h]=r.useState(""),g=async()=>{try{if((await j()).status===200){const t=await b();d(!0),h(t.data.role),n(t.data.username);return}}catch{console.log("Check failed");try{if((await L()).status===200){const l=await j();if(console.log("recheckResponse.status: ",l.status),l.status===200){const i=await b();d(!0),h(i.data.role),n(i.data.username);return}}}catch(t){console.log("Refresh token failed:",t)}}d(!1),h("")};E.useEffect(()=>{u(!0),g(),u(!1)},[]);const N=async s=>{var t,l,i;s.preventDefault(),u(!0),p("");try{(await C(o,m)).status===200&&g()}catch(a){console.error("Full login error:",a),R.isAxiosError(a)?((t=a.response)==null?void 0:t.status)===401?p("Неверное имя пользователя или пароль"):p(`Ошибка сервера: ${(l=a.response)==null?void 0:l.status} - ${(i=a.response)==null?void 0:i.statusText}`):p("Неизвестная ошибка при входе")}finally{u(!1)}},w=async()=>{try{await R.post("https://localhost:5001/api/auth/logout",{},{withCredentials:!0}),d(!1),h("")}catch(s){console.error("Logout error:",s)}},k=()=>{chrome.tabs.create({url:chrome.runtime.getURL("admin.html")})};return c?e.jsx("div",{className:"popup-container",children:e.jsx("div",{className:"popup-text",children:"Проверка авторизации..."})}):e.jsxs("div",{className:"popup-container",children:[e.jsx("div",{className:"popup-header",children:" Вход в Shared Account"}),y?e.jsxs("div",{className:"popup-container",children:[e.jsxs("div",{className:"popup-text",children:["Вы вошли как: ",e.jsx("strong",{children:o}),e.jsx("br",{}),"Роль:"," ",e.jsx("strong",{children:f=="0"?"Администратор":"Пользователь"})]}),f=="0"&&e.jsx("button",{onClick:k,className:"btn btn-primary",children:"Панель администратора"}),e.jsx("div",{className:"logged-btn",children:e.jsx("button",{onClick:w,className:"btn btn-outline-secondary",children:"Выйти"})})]}):e.jsxs("form",{onSubmit:N,children:[e.jsx("div",{className:"input-group mb-3",children:e.jsx("input",{className:"form-control input",id:"username","aria-label":"Имя пользователя",type:"text",value:o,onChange:s=>n(s.target.value),disabled:c})}),e.jsx("div",{className:"input-group mb-3",children:e.jsx("input",{className:"form-control input",id:"password",type:"password","aria-label":"Пароль",value:m,onChange:s=>v(s.target.value),disabled:c})}),x&&e.jsx(A,{children:x}),e.jsx("button",{type:"submit",disabled:c,className:"btn btn-primary",children:c?"Вход...":"Войти"})]})]})},P=S.createRoot(document.getElementById("root"));P.render(e.jsx(I,{}));
